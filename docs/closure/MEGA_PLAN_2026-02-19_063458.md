# [DEPRECADO: 2026-02-19] Mega Plan — Frontend UX Operativo Mini Market

> **Estado:** Reemplazado por plan definitivo.
> **Plan canónico vigente:** `docs/closure/PLAN_FRONTEND_UX_V2_2026-02-19.md`
> **Motivo de deprecación:** consolidación ejecutiva Top 10 sin duplicados, con secuencia por bloques y DoD verificable por tarea.

- Fecha (UTC): `2026-02-19 06:34:58`
- Objetivo: Frontend UX operativo para mini market familiar: dashboard, navegación, flujo con asistente IA y fricción cero.
- Enfoque: usuario no técnico bajo presión (jefe ~60 años + personal multitarea).

## Inputs Canónicos

- Estado general: `docs/ESTADO_ACTUAL.md`
- Continuidad: `docs/closure/CONTINUIDAD_SESIONES.md`
- Pendientes: `docs/closure/OPEN_ISSUES.md`
- Objetivo final: `docs/closure/OBRA_OBJETIVO_FINAL_PRODUCCION/README.md`
- Auditoría UX previa: `docs/audit/EVIDENCIA_SP-A.md`, `docs/audit/EVIDENCIA_SP-B.md`, `docs/audit/EVIDENCIA_SP-C.md`, `docs/audit/EVIDENCIA_SP-D.md`, `docs/audit/EVIDENCIA_SP-F.md`

## Estado Confirmado (2026-02-19)

| Elemento | Estado | Evidencia |
|---|---|---|
| Error handling de páginas | REAL (14/14 con `ErrorMessage`) | `minimarket-system/src/pages/*.tsx` |
| Skeleton loading | PARCIAL (6/14) | `Dashboard.tsx`, `Pedidos.tsx`, `Pos.tsx`, `Productos.tsx`, `Stock.tsx`, `Tareas.tsx` |
| Mutaciones silenciosas HC-3 | CERRADO | `minimarket-system/src/pages/Pedidos.tsx` |
| Cron auth HC-1 | CERRADO | `supabase/migrations/20260211055140_fix_cron_jobs_auth_and_maintenance.sql` |
| Deploy safety HC-2 | CERRADO | `deploy.sh` |
| Flujo IA asistida por insights/search | REAL (parcial, no conversacional) | `minimarket-system/src/lib/apiClient.ts` |
| Onboarding silencioso | A CREAR | sin implementación en `minimarket-system/src` |

## Blockers UX Reales (P0/P1)

1. P0 — Confianza de datos en dashboard: conteos potencialmente subestimados por `limit(5)` y `limit(100)` en métricas críticas.
2. P0 — Navegación móvil saturada: 11 módulos en barra inferior (`grid-cols-8`) para operadores no técnicos.
3. P0 — Flujo de venta no visible a 1 toque desde navegación principal: existe `/pos` pero no aparece en menú principal.
4. P1 — 8 páginas sin Skeleton; experiencia irregular en redes lentas.
5. P1 — Interacción IA para no técnicos es parcial: hay insights y search, pero falta “asistente guiado” con lenguaje y acciones directas.

## Top 10 Ejecutable

1. **Corregir integridad de métricas del dashboard** (Impacto 3, Riesgo medio) | Skill: `CodeCraft`
   - Archivos: `minimarket-system/src/hooks/queries/useDashboardStats.ts`, `minimarket-system/src/pages/Dashboard.tsx`, `minimarket-system/src/pages/Dashboard.test.tsx`
   - DoD:
     - `Tareas Pendientes` y `Stock Bajo` muestran conteos exactos del total real.
     - Las tarjetas no dependen de listas truncadas.
   - Verificación:
     - `pnpm -C minimarket-system test:components -- Dashboard.test.tsx`
     - `pnpm -C minimarket-system build`
   - Evidencia: `docs/closure/EVIDENCIA_FRONTEND_UX_DASHBOARD_METRICS_YYYY-MM-DD.md`
   - Rollback: revertir hook + fallback a comportamiento actual.

2. **Dashboard operativo de 1 toque para tareas críticas** (Impacto 3, Riesgo medio) | Skill: `CodeCraft`
   - Archivos: `minimarket-system/src/pages/Dashboard.tsx`, `minimarket-system/src/components/Layout.tsx`, `minimarket-system/src/App.tsx`
   - DoD:
     - Dashboard incluye botones grandes de acción inmediata: `Vender`, `Stock`, `Pedidos`, `Clientes`.
     - Todas las acciones frecuentes del día se ejecutan en <= 2 toques.
   - Verificación:
     - Test de render + navegación de quick actions.
     - Build y lint.
   - Evidencia: captura de rutas/acciones en `docs/closure/`.
   - Rollback: mantener dashboard actual sin bloqueos de datos.

3. **Rediseñar navegación para baja carga cognitiva** (Impacto 3, Riesgo medio) | Skill: `CodeCraft`
   - Archivos: `minimarket-system/src/components/Layout.tsx`, `minimarket-system/src/lib/roles.ts`
   - DoD:
     - Móvil: bottom nav con máximo 4 items + “Más”.
     - Desktop: agrupación clara por “Operación”, “Control”, “Análisis”.
     - `POS` y `Pocket` accesibles explícitamente para roles habilitados.
   - Verificación:
     - Tests de navegación por rol.
     - Smoke de rutas protegidas.
   - Evidencia: matriz de navegación por rol en `docs/closure/`.
   - Rollback: feature flag para nav legacy.

4. **Crear interfaz de Asistente IA guiado (sin prompts libres obligatorios)** (Impacto 3, Riesgo medio) | Skill: `CodeCraft`
   - Archivos: `minimarket-system/src/pages/Asistente.tsx` (nuevo), `minimarket-system/src/App.tsx`, `minimarket-system/src/components/Layout.tsx`, `minimarket-system/src/lib/apiClient.ts`
   - DoD:
     - Pantalla con chips de consultas frecuentes: reposición, riesgo de pérdida, vencimientos, deuda clientes, compras sugeridas.
     - Cada respuesta muestra “qué hacer ahora” con CTA (ir a módulo / crear tarea / aplicar oferta).
   - Verificación:
     - Tests de interacción de chips y CTA.
     - Build y lint.
   - Evidencia: `docs/closure/EVIDENCIA_ASISTENTE_IA_GUIADO_YYYY-MM-DD.md`
   - Rollback: ocultar ruta `/asistente` si hay regresión.

5. **Subir quick actions visibles fuera del buscador** (Impacto 2, Riesgo bajo) | Skill: `CodeCraft`
   - Archivos: `minimarket-system/src/components/GlobalSearch.tsx`, `minimarket-system/src/pages/Dashboard.tsx`
   - DoD:
     - Quick actions clave visibles en dashboard y no solo en modal de búsqueda.
     - `GlobalSearch` se mantiene como acelerador, no como dependencia de uso básico.
   - Verificación:
     - Test de “happy path” sin usar búsqueda.
   - Evidencia: checklists de flujo operador.
   - Rollback: conservar quick actions únicamente en modal.

6. **Completar Skeleton loading en 8 páginas faltantes** (Impacto 2, Riesgo bajo) | Skill: `UXFixOps`
   - Archivos: `minimarket-system/src/pages/Clientes.tsx`, `minimarket-system/src/pages/Deposito.tsx`, `minimarket-system/src/pages/Kardex.tsx`, `minimarket-system/src/pages/Login.tsx`, `minimarket-system/src/pages/Pocket.tsx`, `minimarket-system/src/pages/Proveedores.tsx`, `minimarket-system/src/pages/Rentabilidad.tsx`, `minimarket-system/src/pages/Ventas.tsx`, `minimarket-system/src/components/Skeleton.tsx`
   - DoD:
     - Cobertura `Skeleton` en 14/14 páginas funcionales.
     - No hay pantallas en blanco ni spinner aislado en flujos principales.
   - Verificación:
     - `rg -n "Skeleton" minimarket-system/src/pages/*.tsx`
     - Build.
   - Evidencia: diff + conteo final en `docs/closure/`.
   - Rollback: fallback a loading textual por página.

7. **Estandarizar mensajes de error para operadores** (Impacto 2, Riesgo bajo) | Skill: `UXFixOps`
   - Archivos: `minimarket-system/src/components/errorMessageUtils.ts`, `minimarket-system/src/components/ErrorMessage.tsx`, `minimarket-system/src/lib/apiClient.ts`, páginas con `toast.error`
   - DoD:
     - Mensajes en español simple con “qué hacer ahora”.
     - Mapeo por `code/status` consistente (401, 403, 429, timeout, red, server).
     - Mantener `requestId` visible para soporte.
   - Verificación:
     - Tests unitarios de `parseErrorMessage`.
     - Test de integración UI de errores comunes.
   - Evidencia: tabla de mapeo error->copy en `docs/closure/`.
   - Rollback: fallback al parser actual.

8. **Implementar onboarding silencioso del primer uso** (Impacto 2, Riesgo bajo) | Skill: `CodeCraft`
   - Archivos: `minimarket-system/src/pages/Dashboard.tsx`, `minimarket-system/src/components/Layout.tsx`, `minimarket-system/src/lib/` (estado local de primer uso)
   - DoD:
     - Primer ingreso muestra guía mínima de 3 pasos con CTA.
     - Se desactiva automáticamente al completar primer flujo.
   - Verificación:
     - Test de comportamiento con localStorage limpio y con estado ya completado.
   - Evidencia: `docs/closure/EVIDENCIA_ONBOARDING_SILENCIOSO_YYYY-MM-DD.md`
   - Rollback: toggle por env/feature flag.

9. **Accesibilidad funcional 60+ (tipografía, contraste, targets táctiles)** (Impacto 2, Riesgo bajo) | Skill: `CodeCraft`
   - Archivos: `minimarket-system/src/components/Layout.tsx`, páginas de operación (`Pos.tsx`, `Pocket.tsx`, `Pedidos.tsx`, `Stock.tsx`, `Dashboard.tsx`)
   - DoD:
     - Botones críticos >= 48px alto.
     - Texto crítico >= 16px en operación.
     - Contraste AA en elementos interactivos.
   - Verificación:
     - Auditoría manual responsive y componentes.
     - Test visual básico en móvil y desktop.
   - Evidencia: checklist a11y en `docs/closure/`.
   - Rollback: clases utilitarias revertibles por componente.

10. **Performance UX y estabilidad percibida** (Impacto 1, Riesgo bajo) | Skill: `PerformanceWatch`
   - Archivos: `minimarket-system/src/hooks/queries/useDashboardStats.ts`, `minimarket-system/src/hooks/useAlertas.ts`, `minimarket-system/src/hooks/useGlobalSearch.ts`, `minimarket-system/src/components/GlobalSearch.tsx`
   - DoD:
     - Reducir trabajo cliente en dashboard (sin conteos truncados ni filtros pesados locales).
     - Tiempo de carga percibido estable con skeleton y caché consistente.
   - Verificación:
     - `npm run test:performance`
     - Build + smoke frontend.
   - Evidencia: baseline antes/después en `docs/closure/`.
   - Rollback: revert de hooks a versión previa.

## Secuencia Recomendada (4 Bloques)

- Bloque A (Quick Wins, 2-3 días): items 1, 5, 6, 7.
- Bloque B (Core UX, 3-4 días): items 2, 3.
- Bloque C (Asistente IA y adopción, 3 días): items 4, 8.
- Bloque D (Hardening final, 2 días): items 9, 10.

## Backlog (fuera del Top 10)

1. Unificar formato monetario local en todos los módulos (`toLocaleString('es-AR')`), incluyendo pedidos.
2. Error boundary granular por módulo en vez de solo boundary global.
3. Atajos de teclado visibles para operaciones de alto volumen.
4. Métricas de adopción por flujo (sin PII) para validar fricción real mes 1.

## Quality Gates por Bloque

```bash
pnpm -C minimarket-system lint
pnpm -C minimarket-system build
pnpm -C minimarket-system test:components
npm run test:unit
```

Para cierre de bloque mayor o despliegue:

```bash
.agent/scripts/p0.sh gates all
```

## Production Readiness Score (Scope Frontend UX)

- Score técnico actual del sistema: `100/100` (GO global vigente).
- Score de UX operativa actual (este scope): `72/100`.
- Target post-plan: `92/100`.

Desglose UX actual:
- Fricción operativa: 14/20
- Intuición inmediata: 12/20
- Velocidad de tareas frecuentes: 13/20
- Feedback/recuperación de errores: 16/20
- Adopción sostenida (onboarding + consistencia): 17/20

## Evidencia Mínima Requerida por Item

- Reporte de ejecución por bloque en `docs/closure/`.
- Comandos y resultados de gates en `test-reports/`.
- Si cambia decisión de arquitectura UX, registrar en `docs/DECISION_LOG.md`.
