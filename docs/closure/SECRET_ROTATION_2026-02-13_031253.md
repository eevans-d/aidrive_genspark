# Secret Rotation Evidence - 2026-02-13 03:12:53 UTC

## Scope
Rotación ejecutada para:
- `API_PROVEEDOR_SECRET`

Pendiente (requiere owner/dashboard):
- `SENDGRID_API_KEY`
- `SMTP_PASS`
- `SMTP_USER` (si cambia en proveedor SMTP)

## Guardrails
- No se expusieron valores de secretos en logs, docs ni terminal.
- No se rotaron `SUPABASE_ANON_KEY` ni `SUPABASE_SERVICE_ROLE_KEY`.
- Se preparó rollback previo (backup local temporal del secreto anterior), y se eliminó tras validación exitosa.

## Pre-checks
1. Inventario remoto de nombres de secretos confirmado con `supabase secrets list`.
2. Validación pre-rotación de autenticación:
   - `GET /functions/v1/api-proveedor/status` con `Authorization` + `x-api-secret` actual -> `200`.

## Execution
1. `supabase secrets set API_PROVEEDOR_SECRET=<new>` (sin imprimir valor).
2. Redeploy:
   - `supabase functions deploy api-proveedor --use-api`
   - `supabase functions deploy scraper-maxiconsumo --use-api`
3. Validaciones post-rotación:
   - `GET /functions/v1/api-proveedor/status` con secreto nuevo -> `200`.
   - `GET /functions/v1/api-proveedor/status` con secreto anterior -> `401`.
   - `GET /functions/v1/api-proveedor/health` con `Authorization` -> `200`.
4. Sincronización local:
   - `.env.test` actualizado con el nuevo `API_PROVEEDOR_SECRET` para smoke/tests locales.

## Result
- `API_PROVEEDOR_SECRET`: ✅ ROTADO y validado end-to-end.
- Funciones redeployadas: ✅ `api-proveedor`, ✅ `scraper-maxiconsumo`.
- Rollback file temporal: eliminado tras éxito.

## Remaining Work
1. Rotar `SENDGRID_API_KEY`/`SMTP_PASS` con una key nueva emitida en SendGrid Dashboard.
2. Redeploy post-SendGrid:
   - `notificaciones-tareas`
   - `cron-notifications`
3. Confirmar entrega real en SendGrid Activity y registrar evidencia adicional.
